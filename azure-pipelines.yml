# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

pool:
  vmImage: 'Ubuntu 16.04'

steps:
- task: CondaEnvironment@0
  inputs:
    environmentName: 'uarray'
    packageSpecs: 'python=3.6 matchpy numba mypy nbconvert numpy pytest'
    updateConda: false
    createOptions: '-c conda-forge'
- script: python -m pip install astunparse
  displayName: 'install astunparse'
- script: cd uarray; mypy uarray
  displayName: 'Run mypy'
- script: cd uarray; jupyter nbconvert --to notebook --inplace --execute NumPy\ Compat.ipynb Transpose\ Test.ipynb
  displayName: 'Run notebooks'
- script: npm install -g codedown
  displayName: Install codedown
- script: cd uarray; cat README.md | codedown python | tail -r | tail -n +2 | tail -r > test_readme.py
  displayName: get code from readme
- script: py.test test_readme.py
  displayName: Test readme